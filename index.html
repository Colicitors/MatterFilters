<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Filter Matters</title>

  <!-- Grist Plugin API (required for hosted widgets) -->
  <script src="https://docs.getgrist.com/grist-plugin-api.js"></script>

  <style>
    :root{
      --page:   #162238;
      --card:   rgba(255,255,255,.08);
      --card2:  rgba(255,255,255,.06);

      --ink:    #f1f5f9;
      --muted:  rgba(241,245,249,.72);
      --border: rgba(255,255,255,.16);
      --shadow: 0 10px 24px rgba(0,0,0,.28);

      --accent: #22d3ee;
      --ring:   rgba(34,211,238,.25);

      --pad: 6px;
      --gap: 6px;
      --radius: 12px;

      --controlH: 30px;
      --fs: 13px;
      --fsSmall: 12px;

      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--ink);
      background:
        radial-gradient(760px 260px at 15% 0%, rgba(96,165,250,.22), transparent 60%),
        radial-gradient(760px 260px at 85% 0%, rgba(34,211,238,.18), transparent 60%),
        linear-gradient(180deg, #101a2d, var(--page));
    }

    .shell{ padding: var(--pad); }

    .card{
      background: linear-gradient(180deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--gap);
      padding: 6px 8px;
      background: linear-gradient(90deg, rgba(96,165,250,.12), rgba(34,211,238,.10));
      border-bottom: 1px solid rgba(255,255,255,.12);
    }

    .title{
      font-weight: 800;
      font-size: 13px;
      color: #ffffff;
      display:flex;
      align-items:center;
      gap: 8px;
      white-space: nowrap;
    }

    .tag{
      display:none;
      align-items:center;
      gap:6px;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(34,211,238,.26);
      background: rgba(34,211,238,.14);
      color: #eaffff;
      max-width: 280px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag .hl{
      background: rgba(34,211,238,.22);
      border: 1px solid rgba(34,211,238,.34);
      padding: 1px 8px;
      border-radius: 999px;
      font-weight: 800;
    }

    .right{
      display:flex;
      align-items:center;
      gap: 6px;
    }

    .pill{
      font-size: 12px;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      color: #ffffff;
    }

    button{
      height: var(--controlH);
      padding: 0 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: var(--ink);
      font-size: var(--fsSmall);
      cursor:pointer;
    }

    .content{
      padding: 8px;
      display:grid;
      gap: var(--gap);
    }

    .rowMain{
      display:grid;
      align-items:center;
      gap: var(--gap);
      grid-template-columns:
        minmax(130px,.8fr)
        minmax(140px,.9fr)
        minmax(140px,1fr)
        minmax(140px,1fr)
        auto
        minmax(220px,1.6fr);
    }

    .sr-only{
      position:absolute;width:1px;height:1px;
      overflow:hidden;clip:rect(0,0,0,0);
    }

    input, select{
      height: var(--controlH);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(255,255,255,.12);
      padding: 0 10px;
      font-size: var(--fs);
      color: #ffffff;
    }

    select option{
      background-color: #f8fafc;
      color: #0f172a;
    }

    .orPill{
      font-size: 11px;
      letter-spacing:.14em;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
    }

    .searchWrap{ position:relative; }
    .searchWrap input{ width:100%; padding-right:32px; }

    .clearX{
      position:absolute;
      right:7px;top:50%;
      transform:translateY(-50%);
      height:20px;width:20px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(255,255,255,.12);
      display:none;
      cursor:pointer;
    }

    .err{ font-size:12px;color:#fecaca; }

    @media (max-width:920px){
      .rowMain{ grid-template-columns:1fr 1fr; }
      .orPill{ display:none; }
      .searchWrap{ grid-column:1 / -1; }
    }
  </style>
</head>

<body>
<div class="shell">
<div class="card">

  <div class="topbar">
    <div class="title">
      Filter Matters
      <span class="tag" id="searchTag">
        Search <span class="hl" id="searchHL"></span>
      </span>
    </div>
    <div class="right">
      <span class="pill" id="count">0 matches</span>
      <button id="clearBtn">Clear</button>
    </div>
  </div>

  <div class="content">
    <div class="rowMain">
      <select id="yearSel"></select>
      <select id="statusSel"></select>
      <select id="lawyerSel"></select>
      <select id="typeSel"></select>

      <span class="orPill">OR</span>

      <div class="searchWrap">
        <input
          id="q"
          type="search"
          placeholder="Search by MatterID, Client, or Subject"
          title="Search by MatterID, Client, or Subject. Press Enter to search. Filters are ignored while searching. Press Esc to clear."
          autocomplete="off"
        />
        <button class="clearX" id="clearX">Ã—</button>
      </div>
    </div>

    <div class="err" id="err"></div>
  </div>

</div>
</div>

<script>
grist.ready({ requiredAccess: "read table", allowSelectBy: true });

const q = document.getElementById("q");
const clearX = document.getElementById("clearX");
const countEl = document.getElementById("count");
const searchTag = document.getElementById("searchTag");
const searchHL = document.getElementById("searchHL");

const selects = ["yearSel","statusSel","lawyerSel","typeSel"]
  .map(id => document.getElementById(id));

let rows=[], state={queryDraft:"",query:""};

function norm(v){ return v==null?"":String(v); }

function searching(){ return state.query.trim().length>0; }

function syncUIForMode(){
  const s = searching();
  selects.forEach(sel => sel.disabled = s);
  searchTag.style.display = s ? "inline-flex" : "none";
  if(s) searchHL.textContent = state.query;

  q.placeholder = "Search by MatterID, Client, or Subject";
  q.title =
    "Search by MatterID, Client, or Subject. Press Enter to search. Filters are ignored while searching. Press Esc to clear.";
}

function updateClearX(){
  clearX.style.display = norm(state.queryDraft) ? "inline-flex" : "none";
}

q.addEventListener("input",()=>{
  state.queryDraft=q.value;
  updateClearX();
});

q.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    state.query=state.queryDraft.trim();
    syncUIForMode();
  }
  if(e.key==="Escape"){
    state.queryDraft=state.query="";
    q.value="";
    updateClearX();
    syncUIForMode();
  }
});

clearX.onclick=()=>{
  state.queryDraft=state.query="";
  q.value="";
  updateClearX();
  syncUIForMode();
};
</script>
</body>
</html>
